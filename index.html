<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç ”ç©¶å®¤ - åˆå¾Œ11:47</title>
    <style>
        body {
            margin: 0;
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
            transition: all 2s ease;
        }

        .room {
            position: relative;
            width: 100%;
            height: 100vh;
            background: linear-gradient(180deg, #2d2d2d 0%, #1a1a1a 70%);
            background-image: 
                radial-gradient(circle at 50% 10%, rgba(255,255,150,0.1) 0%, transparent 50%),
                repeating-linear-gradient(90deg, transparent, transparent 98px, rgba(255,255,255,0.02) 100px);
        }

        .ceiling-light {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 20px;
            background: rgba(255,255,150,0.8);
            border-radius: 50%;
            box-shadow: 0 0 100px rgba(255,255,150,0.3);
            animation: flicker 3s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
            75% { opacity: 0.9; }
        }

        .desk {
            position: absolute;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 120px;
            background: #4a4a4a;
            border-radius: 5px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .computer {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 120px;
            background: #2a2a2a;
            border: 2px solid #555;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            text-align: center;
            box-shadow: 0 0 20px rgba(0,150,255,0.3);
        }

        .computer.glitch {
            animation: computerGlitch 0.1s infinite;
        }

        @keyframes computerGlitch {
            0% { transform: translateX(-50%) translateY(0); }
            25% { transform: translateX(-52%) translateY(-2px); }
            50% { transform: translateX(-48%) translateY(2px); }
            75% { transform: translateX(-51%) translateY(-1px); }
            100% { transform: translateX(-50%) translateY(0); }
        }

        .papers {
            position: absolute;
            top: 20px;
            right: 30px;
            width: 80px;
            height: 100px;
            background: #f0f0f0;
            color: #333;
            font-size: 8px;
            padding: 5px;
            border-radius: 3px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transform: rotate(-5deg);
        }

        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            z-index: 1000;
        }

        .loop-counter {
            font-size: 18px;
            color: #ff6b6b;
            font-weight: bold;
        }

        .time {
            font-size: 16px;
            color: #4ecdc4;
        }

        .memory-fragments {
            font-size: 14px;
            color: #ffd700;
        }

        .message-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 600px;
            border: 2px solid #ff6b6b;
            z-index: 2000;
        }

        .message-overlay h2 {
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .message-overlay.memory {
            border-color: #4ecdc4;
        }

        .message-overlay.memory h2 {
            color: #4ecdc4;
        }

        .message-overlay.final {
            border-color: #ffd700;
            animation: finalGlow 1s infinite alternate;
        }

        .message-overlay.final h2 {
            color: #ffd700;
        }

        @keyframes finalGlow {
            from { box-shadow: 0 0 20px rgba(255,215,0,0.5); }
            to { box-shadow: 0 0 40px rgba(255,215,0,0.8); }
        }

        .hidden { display: none; }

        .instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: #ccc;
            padding: 15px;
            border-radius: 5px;
            font-size: 14px;
            max-width: 300px;
        }

        .glitch-effect {
            animation: screenGlitch 0.1s infinite;
        }

        @keyframes screenGlitch {
            0% { transform: translateX(0); }
            10% { transform: translateX(-2px); }
            20% { transform: translateX(2px); }
            30% { transform: translateX(-1px); }
            40% { transform: translateX(1px); }
            50% { transform: translateX(-2px); }
            60% { transform: translateX(2px); }
            70% { transform: translateX(-1px); }
            80% { transform: translateX(1px); }
            90% { transform: translateX(-2px); }
            100% { transform: translateX(0); }
        }

        .red-tint {
            background: linear-gradient(180deg, #3d2d2d 0%, #2a1a1a 70%);
        }

        .blue-tint {
            background: linear-gradient(180deg, #2d2d3d 0%, #1a1a2a 70%);
        }

        .error-text {
            position: fixed;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 72px;
            color: #ff0000;
            font-weight: bold;
            opacity: 0;
            animation: errorFlash 2s ease-in-out;
            z-index: 10000;
            text-shadow: 0 0 20px #ff0000;
            background: rgba(0,0,0,0.9);
            padding: 20px 40px;
            border-radius: 10px;
            white-space: nowrap;
        }

        @keyframes errorFlash {
            0% { opacity: 0; transform: translateX(-50%) translateY(-100px) scale(0.5); }
            20% { opacity: 1; transform: translateX(-50%) translateY(50px) scale(1.2); }
            80% { opacity: 1; transform: translateX(-50%) translateY(50px) scale(1); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-100px) scale(0.8); }
        }

        .system-breach {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,0,0,0.1);
            z-index: 9999;
            opacity: 0;
            animation: systemBreach 3s ease-in-out;
        }

        @keyframes systemBreach {
            0% { opacity: 0; }
            10% { opacity: 1; background: rgba(255,0,0,0.3); }
            20% { opacity: 0; }
            30% { opacity: 1; background: rgba(255,0,0,0.2); }
            40% { opacity: 0; }
            50% { opacity: 1; background: rgba(255,0,0,0.4); }
            100% { opacity: 0; }
        }

        .reality-crack {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 100vh;
            background: linear-gradient(45deg, transparent 49%, #ff0000 49.5%, #ff0000 50.5%, transparent 51%);
            z-index: 9998;
            opacity: 0;
            animation: realityCrack 1.5s ease-in-out;
        }

        @keyframes realityCrack {
            0% { opacity: 0; transform: scaleX(0); }
            50% { opacity: 1; transform: scaleX(1); }
            100% { opacity: 0; transform: scaleX(1); }
        }

        .dimension-shift {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 96px;
            color: #00ffff;
            font-weight: bold;
            opacity: 0;
            z-index: 10001;
            text-shadow: 0 0 30px #00ffff;
            animation: dimensionShift 4s ease-in-out;
            white-space: nowrap;
        }

        @keyframes dimensionShift {
            0% { opacity: 0; transform: translateX(-50%) translateY(-200px) rotateX(90deg); }
            25% { opacity: 1; transform: translateX(-50%) translateY(100px) rotateX(0deg); }
            75% { opacity: 1; transform: translateX(-50%) translateY(100px) rotateX(0deg); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-200px) rotateX(-90deg); }
        }

        .memory-extraction {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 10px,
                rgba(255,255,0,0.1) 10px,
                rgba(255,255,0,0.1) 20px
            );
            z-index: 9997;
            opacity: 0;
            animation: memoryExtraction 5s ease-in-out;
        }

        @keyframes memoryExtraction {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .final-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #ffd700;
            font-weight: bold;
            opacity: 0;
            z-index: 10002;
            text-align: center;
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border: 3px solid #ffd700;
            border-radius: 20px;
            animation: finalWarning 6s ease-in-out;
            box-shadow: 0 0 50px rgba(255,215,0,0.5);
        }

        @keyframes finalWarning {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            30% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.1); }
        }

        .shadow-figure {
            position: absolute;
            bottom: 100px;
            right: 100px;
            width: 60px;
            height: 150px;
            background: rgba(0,0,0,0.8);
            border-radius: 30px 30px 0 0;
            opacity: 0;
            animation: shadowAppear 2s ease-in-out;
        }

        @keyframes shadowAppear {
            0% { opacity: 0; transform: translateX(100px); }
            50% { opacity: 0.7; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(-50px); }
        }
    </style>
</head>
<body>
    <div class="status-bar">
        <div class="loop-counter">ãƒ«ãƒ¼ãƒ—å›æ•°: <span id="loopCount">1</span></div>
        <div class="time">æ™‚åˆ»: <span id="currentTime">23:47:00</span></div>
        <div class="memory-fragments">è¨˜æ†¶ã®æ¬ ç‰‡: <span id="memoryCount">0</span>/7</div>
    </div>

    <div id="room" class="room">
        <div class="ceiling-light"></div>
        
        <div class="desk">
            <div id="computer" class="computer">
                <div id="computerText">
                    ãƒ­ã‚°ã‚¤ãƒ³ä¸­...<br>
                    ç ”ç©¶ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹<br>
                    æ¥ç¶šæº–å‚™ä¸­
                </div>
            </div>
            
            <div id="papers" class="papers">
                å®Ÿé¨“ãƒ­ã‚° #001<br>
                â–“â–“â–“â–“â–“â–“â–“<br>
                ç•°å¸¸ãªã—<br>
                â–“â–“â–“â–“â–“â–“â–“<br>
                ç¶šè¡Œ
            </div>
        </div>
    </div>

    <div id="messageOverlay" class="message-overlay hidden">
        <h2 id="messageTitle">ç ”ç©¶å®¤ã¸ã‚ˆã†ã“ã</h2>
        <p id="messageContent">
            ã‚ãªãŸã¯æ·±å¤œã®ç ”ç©¶å®¤ã«ã„ã¾ã™ã€‚<br>
            ä½•ã‹ãŒ...ãŠã‹ã—ã„ã€‚<br><br>
            <strong>F5ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ä¸–ç•Œã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„</strong><br>
            çœŸå®Ÿã‚’è¦‹ã¤ã‘å‡ºã™ãŸã‚ã«...
        </p>
        <button id="continueBtn" onclick="closeMessage()">ç¶šè¡Œ</button>
    </div>

    <div class="instructions">
        ğŸ”„ <strong>F5ã‚­ãƒ¼</strong> - ä¸–ç•Œã‚’ãƒªã‚»ãƒƒãƒˆ<br>
        ğŸ‘ï¸ å¤‰åŒ–ã‚’è¦³å¯Ÿã—ã€çœŸå®Ÿã‚’è¦‹ã¤ã‘å‡ºã—ã¦ãã ã•ã„<br>
        ğŸ’­ è¨˜æ†¶ã®æ¬ ç‰‡ã‚’é›†ã‚ã¾ã—ã‚‡ã†<br>
        <button id="resetBtn" onclick="resetGame()" style="margin-top: 10px; padding: 5px 10px; background: #ff6b6b; color: white; border: none; border-radius: 3px; cursor: pointer;">ğŸ”„ ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†ï¼ˆæ°¸ç¶šåŒ–ï¼‰
        const GAME_DATA_KEY = 'refreshLoopGame';
        let gameData = {
            loopCount: 1,
            memoriesUnlocked: [],
            totalMemories: 7,
            gamePhase: 'intro'
        };

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.addEventListener('load', () => {
            loadGameData();
            initializeLoop();
            
            // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
            if (gameData.loopCount === 1) {
                setTimeout(() => {
                    showMessage('ç ”ç©¶å®¤ã¸ã‚ˆã†ã“ã', 
                        'ã‚ãªãŸã¯æ·±å¤œã®ç ”ç©¶å®¤ã«ã„ã¾ã™ã€‚<br>ä½•ã‹ãŒ...ãŠã‹ã—ã„ã€‚<br><br><strong>F5ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ä¸–ç•Œã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„</strong><br>çœŸå®Ÿã‚’è¦‹ã¤ã‘å‡ºã™ãŸã‚ã«...');
                }, 2000);
            }
        });

        function loadGameData() {
            const saved = sessionStorage.getItem(GAME_DATA_KEY);
            if (saved) {
                gameData = { ...gameData, ...JSON.parse(saved) };
            }
        }

        function saveGameData() {
            sessionStorage.setItem(GAME_DATA_KEY, JSON.stringify(gameData));
        }

        function initializeLoop() {
            updateUI();
            
            // ãƒ«ãƒ¼ãƒ—å›æ•°ã«å¿œã˜ã¦ç•°ãªã‚‹ä½“é¨“
            switch(gameData.loopCount) {
                case 1:
                    // é€šå¸¸ã®ç ”ç©¶å®¤
                    break;
                case 2:
                    loop2Experience();
                    break;
                case 3:
                    loop3Experience();
                    break;
                case 4:
                    loop4Experience();
                    break;
                case 5:
                    loop5Experience();
                    break;
                case 6:
                    loop6Experience();
                    break;
                case 7:
                    loop7Experience();
                    break;
                case 8:
                    loop8Experience();
                    break;
                default:
                    if (gameData.loopCount > 8) {
                        endlessLoop();
                    }
            }

            // ãƒ«ãƒ¼ãƒ—å›æ•°ã‚’å¢—åŠ ã—ã¦ä¿å­˜
            gameData.loopCount++;
            saveGameData();
        }

        function updateUI() {
            document.getElementById('loopCount').textContent = gameData.loopCount;
            document.getElementById('memoryCount').textContent = gameData.memoriesUnlocked.length;
            
            // æ™‚åˆ»ã‚’å¾®å¦™ã«å¤‰åŒ–ã•ã›ã‚‹
            const baseTime = new Date();
            baseTime.setHours(23, 47, gameData.loopCount % 60);
            document.getElementById('currentTime').textContent = baseTime.toTimeString().slice(0, 8);
        }

        // ãƒ«ãƒ¼ãƒ—2: ç´™ã®å†…å®¹ãŒå¤‰åŒ–
        function loop2Experience() {
            setTimeout(() => {
                document.getElementById('papers').innerHTML = `
                    å®Ÿé¨“ãƒ­ã‚° #002<br>
                    æ™‚é–“ç•°å¸¸æ¤œå‡º<br>
                    <span style="color: red;">è­¦å‘Š</span><br>
                    ãƒ«ãƒ¼ãƒ—ç¾è±¡<br>
                    èª¿æŸ»å¿…è¦
                `;
                unlockMemory(0, 'ã‚ãªãŸã¯å‰ã«ã‚‚ã“ã“ã«ã„ãŸ...');
            }, 3000);
        }

        // ãƒ«ãƒ¼ãƒ—3: ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ç”»é¢ãŒç•°å¸¸
        function loop3Experience() {
            setTimeout(() => {
                document.getElementById('computer').classList.add('glitch');
                document.getElementById('computerText').innerHTML = `
                    ERROR_404<br>
                    <span style="color: red;">REALITY.EXE</span><br>
                    ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
                `;
                unlockMemory(1, 'ç¾å®ŸãŒå´©å£Šã—å§‹ã‚ã¦ã„ã‚‹...');
            }, 2000);

            setTimeout(() => {
                document.body.classList.add('glitch-effect');
                
                // å¤§ããªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸Šéƒ¨ã«è¡¨ç¤º
                const errorText = document.createElement('div');
                errorText.className = 'error-text';
                errorText.textContent = 'SYSTEM ERROR';
                document.body.appendChild(errorText);
                
                setTimeout(() => {
                    errorText.remove();
                }, 2000);
            }, 4000);
        }

        // ãƒ«ãƒ¼ãƒ—4: éƒ¨å±‹ã®è‰²èª¿ãŒå¤‰åŒ–
        function loop4Experience() {
            document.getElementById('room').classList.add('red-tint');
            
            // ã‚·ã‚¹ãƒ†ãƒ ä¾µå®³æ¼”å‡º
            const breach = document.createElement('div');
            breach.className = 'system-breach';
            document.body.appendChild(breach);
            
            setTimeout(() => {
                // ç¾å®Ÿã«ã²ã³å‰²ã‚Œæ¼”å‡º
                const crack = document.createElement('div');
                crack.className = 'reality-crack';
                document.body.appendChild(crack);
                
                setTimeout(() => {
                    crack.remove();
                }, 1500);
                
                unlockMemory(2, 'ä½•ã‹ãŒã“ã®ç©ºé–“ã‚’ä¾µé£Ÿã—ã¦ã„ã‚‹...');
            }, 1500);
            
            setTimeout(() => {
                breach.remove();
            }, 3000);
        }

        // ãƒ«ãƒ¼ãƒ—5: å½±ã®äººå½±ãŒç¾ã‚Œã‚‹
        function loop5Experience() {
            document.getElementById('room').classList.add('blue-tint');
            
            // æ¬¡å…ƒã‚·ãƒ•ãƒˆæ¼”å‡º
            const dimensionText = document.createElement('div');
            dimensionText.className = 'dimension-shift';
            dimensionText.textContent = 'DIMENSION SHIFT';
            document.body.appendChild(dimensionText);
            
            setTimeout(() => {
                const shadow = document.createElement('div');
                shadow.className = 'shadow-figure';
                document.getElementById('room').appendChild(shadow);
                
                unlockMemory(3, 'èª°ã‹ãŒã‚ãªãŸã‚’è¦‹ã¦ã„ã‚‹...');
            }, 2000);
            
            setTimeout(() => {
                dimensionText.remove();
            }, 4000);
        }

        // ãƒ«ãƒ¼ãƒ—6: çœŸå®Ÿã®ä¸€éƒ¨ãŒæ˜ã‹ã•ã‚Œã‚‹
        function loop6Experience() {
            // è¨˜æ†¶æŠ½å‡ºæ¼”å‡º
            const extraction = document.createElement('div');
            extraction.className = 'memory-extraction';
            document.body.appendChild(extraction);
            
            setTimeout(() => {
                document.getElementById('papers').innerHTML = `
                    <span style="color: red;">æ©Ÿå¯†æ–‡æ›¸</span><br>
                    å®Ÿé¨“å¯¾è±¡: ${generateRandomName()}<br>
                    çŠ¶æ…‹: æ™‚é–“ãƒ«ãƒ¼ãƒ—<br>
                    ç›®çš„: è¨˜æ†¶æŠ½å‡º<br>
                    <span style="color: red;">å®Ÿé¨“ç¶™ç¶šä¸­</span>
                `;
                
                unlockMemory(4, 'ã‚ãªãŸã¯å®Ÿé¨“ã®è¢«é¨“è€…ã ã£ãŸ...');
            }, 2000);
            
            setTimeout(() => {
                extraction.remove();
            }, 5000);
        }

        // ãƒ«ãƒ¼ãƒ—7: ã‚ˆã‚Šè©³ç´°ãªçœŸå®Ÿ
        function loop7Experience() {
            setTimeout(() => {
                document.getElementById('computerText').innerHTML = `
                    è¢«é¨“è€… #7834<br>
                    <span style="color: yellow;">è¨˜æ†¶æŠ½å‡º</span><br>
                    é€²è¡Œç‡: 85%<br>
                    <span style="color: red;">æŠµæŠ—æ¤œå‡º</span>
                `;
                
                unlockMemory(5, 'å½¼ã‚‰ã¯ã‚ãªãŸã®è¨˜æ†¶ã‚’ç›—ã‚“ã§ã„ã‚‹...');
            }, 1000);

            setTimeout(() => {
                showMessage('è¨˜æ†¶ã®æ–­ç‰‡', 
                    'ç ”ç©¶æ‰€ã®çœŸå®ŸãŒè¦‹ãˆã¦ãã¾ã—ãŸã€‚<br>ã‚ãªãŸã¯è¨˜æ†¶æŠ½å‡ºå®Ÿé¨“ã®è¢«é¨“è€…ã§ã™ã€‚<br><br>æœ€å¾Œã®è¨˜æ†¶ã‚’å–ã‚Šæˆ»ã—ã¦ãã ã•ã„...', 
                    'memory');
            }, 4000);
        }

        // ãƒ«ãƒ¼ãƒ—8: æœ€çµ‚çš„ãªçœŸå®Ÿã¨ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
        function loop8Experience() {
            // æœ€çµ‚è­¦å‘Šæ¼”å‡º
            const finalWarning = document.createElement('div');
            finalWarning.className = 'final-warning';
            finalWarning.innerHTML = `
                âš ï¸ CRITICAL ALERT âš ï¸<br>
                <div style="font-size: 24px; margin-top: 20px;">
                è¢«é¨“è€…è¦šé†’æ¤œå‡º<br>
                å®Ÿé¨“å¼·åˆ¶çµ‚äº†ä¸­...
                </div>
            `;
            document.body.appendChild(finalWarning);
            
            setTimeout(() => {
                document.getElementById('papers').innerHTML = `
                    <span style="color: gold;">æ¥µç§˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</span><br>
                    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:<br>
                    <strong>ETERNAL LOOP</strong><br>
                    ç›®çš„: å®Œå…¨è¨˜æ†¶æŠ½å‡º<br>
                    <span style="color: red;">è¢«é¨“è€…æŠ¹æ¶ˆäºˆå®š</span>
                `;

                document.getElementById('computerText').innerHTML = `
                    <span style="color: red;">è­¦å‘Š</span><br>
                    è¢«é¨“è€…è¦šé†’<br>
                    <span style="color: yellow;">ç·Šæ€¥åœæ­¢</span><br>
                    å®Ÿè¡Œä¸­...
                `;
                
                unlockMemory(6, 'çœŸå®Ÿ: ã‚ãªãŸã¯è¨˜æ†¶ã‚’å–ã‚Šæˆ»ã—ãŸ...');
            }, 2000);

            setTimeout(() => {
                finalWarning.remove();
                if (gameData.memoriesUnlocked.length >= 7) {
                    showFinalEnding();
                }
            }, 6000);
        }

        // ç„¡é™ãƒ«ãƒ¼ãƒ—ï¼ˆã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å¾Œï¼‰
        function endlessLoop() {
            document.body.style.background = '#000';
            document.getElementById('room').innerHTML = `
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #fff;">
                    <h1>ã‚ãªãŸã¯è‡ªç”±ã«ãªã£ãŸ</h1>
                    <p>ã—ã‹ã—ã€ã“ã®ä¸–ç•Œã¯ã¾ã ç¶šã„ã¦ã„ã‚‹...</p>
                    <p style="color: #666; font-size: 12px;">F5ã‚’æŠ¼ã—ç¶šã‘ã‚‹ã“ã¨ã§ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã®ç¾ã—ã•ã‚’ä½“é¨“ã§ãã¾ã™</p>
                </div>
            `;
        }

        function unlockMemory(index, message) {
            if (!gameData.memoriesUnlocked.includes(index)) {
                gameData.memoriesUnlocked.push(index);
                saveGameData();
                updateUI();
                
                setTimeout(() => {
                    showMessage('è¨˜æ†¶ã®æ¬ ç‰‡ã‚’å–å¾—', message, 'memory');
                }, 1000);
            }
        }

        function showMessage(title, content, type = 'normal') {
            document.getElementById('messageTitle').textContent = title;
            document.getElementById('messageContent').innerHTML = content;
            
            const overlay = document.getElementById('messageOverlay');
            overlay.className = `message-overlay ${type}`;
            overlay.classList.remove('hidden');
        }

        function closeMessage() {
            document.getElementById('messageOverlay').classList.add('hidden');
        }

        function showFinalEnding() {
            showMessage('çœŸå®Ÿã®è¨˜æ†¶', 
                'å…¨ã¦ã®è¨˜æ†¶ã‚’å–ã‚Šæˆ»ã—ã¾ã—ãŸã€‚<br><br>' +
                'ã‚ãªãŸã¯ç ”ç©¶æ‰€ã®ç§˜å¯†å®Ÿé¨“ã®è¢«é¨“è€…ã§ã—ãŸã€‚<br>' +
                'å½¼ã‚‰ã¯ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ã£ã¦ã‚ãªãŸã®è¨˜æ†¶ã‚’æŠ½å‡ºã—ã¦ã„ã¾ã—ãŸã€‚<br><br>' +
                '<strong>ã—ã‹ã—ã€ã‚ãªãŸã¯æŠµæŠ—ã—ã€çœŸå®Ÿã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚</strong><br><br>' +
                'ã‚‚ã†ä¸€åº¦F5ã‚’æŠ¼ã™ã¨ã€çœŸã®è‡ªç”±ãŒå¾…ã£ã¦ã„ã¾ã™...', 
                'final');
        }

        function generateRandomName() {
            const names = ['ç”°ä¸­', 'ä½è—¤', 'éˆ´æœ¨', 'é«˜æ©‹', 'ä¼Šè—¤'];
            return names[gameData.loopCount % names.length];
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
        function resetGame() {
            if (confirm('æœ¬å½“ã«ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nå…¨ã¦ã®é€²è¡ŒçŠ¶æ³ãŒå¤±ã‚ã‚Œã¾ã™ã€‚')) {
                sessionStorage.removeItem(GAME_DATA_KEY);
                location.reload();
            }
        }

        // F5ã‚­ãƒ¼ã§ã®ãƒªãƒ­ãƒ¼ãƒ‰ã‚’æ¤œçŸ¥ï¼ˆå®Ÿéš›ã®ãƒªãƒ­ãƒ¼ãƒ‰ã¯é˜»æ­¢ã—ãªã„ï¼‰
        window.addEventListener('beforeunload', () => {
            // ãƒªãƒ­ãƒ¼ãƒ‰ç›´å‰ã®å‡¦ç†ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        });

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'r' && e.ctrlKey) {
                // Ctrl+R ã®å ´åˆã‚‚ F5 ã¨åŒã˜æ‰±ã„
                e.preventDefault();
                location.reload();
            }
        });
    </script>
</body>
</html>
